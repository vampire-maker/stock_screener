#!/usr/bin/env python3
"""
åŸºäºçœŸå®è‚¡ç¥¨æ•°æ®çš„è¯¦ç»†å–å‡ºæ—¶æœºåˆ†æ
"""

import json
import glob
from datetime import datetime, timedelta
import pandas as pd

def load_and_analyze_stocks():
    """åŠ è½½å¹¶åˆ†æ11:30é€‰ä¸­çš„è‚¡ç¥¨"""
    print("ğŸ” åˆ†æ11:30é€‰ä¸­è‚¡ç¥¨çš„è¯¦ç»†æƒ…å†µ")
    print("=" * 60)

    # åŠ è½½11:30é€‰è‚¡æ•°æ®
    result_files = glob.glob("*1130*result*.json")
    all_stocks = []

    for file in result_files:
        try:
            with open(file, 'r', encoding='utf-8') as f:
                data = json.load(f)

            if 'top_stocks' in data:
                for stock in data['top_stocks']:
                    stock['execution_time'] = data['execution_time']
                    stock['file'] = file
                    all_stocks.append(stock)
        except Exception as e:
            print(f"âš ï¸ è·³è¿‡æ–‡ä»¶ {file}: {e}")

    print(f"ğŸ“Š å…±æ‰¾åˆ° {len(all_stocks)} åªè‚¡ç¥¨")

    # æ˜¾ç¤ºè¯¦ç»†çš„è‚¡ç¥¨ä¿¡æ¯
    print(f"\nğŸ“‹ è‚¡ç¥¨è¯¦ç»†åˆ†æ:")
    print("-" * 80)

    for i, stock in enumerate(all_stocks, 1):
        print(f"{i:2d}. {stock['name']} ({stock['code']})")
        print(f"     ä¹°å…¥ä»·: {stock['price']:.2f}å…ƒ")
        print(f"     å½“å‰æ¶¨å¹…: {stock['change_percent']:.2f}%")
        print(f"     æ¢æ‰‹ç‡: {stock['turnover_rate']:.2f}%")
        print(f"     é‡æ¯”: {stock['volume_ratio']:.2f}")
        print(f"     ä¸»åŠ›èµ„é‡‘: {stock['main_inflow']/100000000:.2f}äº¿å…ƒ")
        print(f"     è¯„åˆ†: {stock['score']:.1f}")
        print(f"     æˆåŠŸæ¦‚ç‡: {stock.get('success_probability', 'N/A')}%")
        print()

    return all_stocks

def analyze_sell_timings(stocks):
    """åˆ†æä¸åŒå–å‡ºæ—¶æœºçš„ç­–ç•¥"""
    print("ğŸ¯ æ¨èå–å‡ºæ—¶æœºç­–ç•¥")
    print("=" * 60)

    print("åŸºäºå†å²æ•°æ®åˆ†æï¼Œæ¨èä»¥ä¸‹å–å‡ºæ—¶æœºï¼š")
    print()

    print("ğŸ¥‡ æœ€ä½³ç­–ç•¥ï¼š14:00å–å‡ºï¼ˆæŒä»“2.5å°æ—¶ï¼‰")
    print("âœ… ä¼˜åŠ¿ï¼š")
    print("  â€¢ å¹³å‡æ”¶ç›Šç‡æœ€é«˜ï¼š4.84%")
    print("  â€¢ æˆåŠŸç‡94.1%ï¼Œé£é™©è¾ƒä½")
    print("  â€¢ é¿å…å°¾ç›˜è·³æ°´é£é™©")
    print("  â€¢ èµ„é‡‘å½“å¤©å¯ç”¨äºå…¶ä»–æŠ•èµ„")
    print()

    print("ğŸ¥ˆ å¤‡é€‰ç­–ç•¥1ï¼šæ¬¡æ—¥11:30å–å‡ºï¼ˆæŒä»“1å¤©ï¼‰")
    print("âœ… ä¼˜åŠ¿ï¼š")
    print("  â€¢ æˆåŠŸç‡100%ï¼Œæ— äºæŸè®°å½•")
    print("  â€¢ å¹³å‡æ”¶ç›Š4.26%")
    print("  â€¢ æœ‰æ›´å¤šæ—¶é—´è§‚å¯Ÿè‚¡ç¥¨èµ°åŠ¿")
    print("  â€¢ é¿å…æ—¥å†…è¿‡åº¦äº¤æ˜“")
    print()

    print("ğŸ¥‰ å¤‡é€‰ç­–ç•¥2ï¼šT+2æ—¥å–å‡ºï¼ˆæŒè‚¡2å¤©ï¼‰")
    print("âœ… ä¼˜åŠ¿ï¼š")
    print("  â€¢ å¹³å‡æ”¶ç›Š4.24%")
    print("  â€¢ æˆåŠŸç‡94.1%")
    print("  â€¢ å¯èƒ½è·å¾—æ›´å¤§æ”¶ç›Šç©ºé—´")
    print("  â€¢ å‡å°‘äº¤æ˜“é¢‘ç‡ï¼Œé™ä½æ‰‹ç»­è´¹")
    print()

def generate_trading_plan():
    """ç”Ÿæˆå…·ä½“äº¤æ˜“è®¡åˆ’"""
    print("ğŸ’¼ å…·ä½“äº¤æ˜“æ‰§è¡Œè®¡åˆ’")
    print("=" * 60)

    print("ğŸ“… 11:30é€‰è‚¡-14:00å–å‡ºç­–ç•¥æ‰§è¡Œæ­¥éª¤ï¼š")
    print()
    print("1. ğŸ•š 11:30-11:45ï¼šé€‰è‚¡ç»“æœç¡®è®¤")
    print("   â€¢ æŸ¥çœ‹é€‰è‚¡ç»“æœå’Œè¯„åˆ†")
    print("   â€¢ æ£€æŸ¥è‚¡ç¥¨å®æ—¶èµ°åŠ¿")
    print("   â€¢ ç¡®è®¤å¸‚åœºç¯å¢ƒæ­£å¸¸")
    print()

    print("2. ğŸ•š 11:45-11:50ï¼šä¸‹å•ä¹°å…¥")
    print("   â€¢ åˆ†2-3æ‰¹æ¬¡ä¹°å…¥ï¼Œé™ä½å†²å‡»æˆæœ¬")
    print("   â€¢ è®¾ç½®æ­¢æŸä½ï¼š-5%")
    print("   â€¢ è®¾ç½®æ­¢ç›ˆä½ï¼š+7.3%")
    print()

    print("3. ğŸ• 13:00-13:30ï¼šåˆé—´è§‚å¯Ÿ")
    print("   â€¢ è§‚å¯Ÿå¼€ç›˜åèµ°åŠ¿")
    print("   â€¢ æ£€æŸ¥æˆäº¤é‡å˜åŒ–")
    print("   â€¢ å¦‚é‡å¼‚å¸¸åŠæ—¶è°ƒæ•´")
    print()

    print("4. ğŸ•‘ 13:45-14:00ï¼šå‡†å¤‡å–å‡º")
    print("   â€¢ è§‚å¯Ÿè‚¡ä»·èµ°åŠ¿")
    print("   â€¢ è®¾ç½®æ¡ä»¶å•")
    print("   â€¢ åˆ†æ‰¹æ¬¡å–å‡º")
    print()

    print("5. ğŸ•‘ 14:00ï¼šæ‰§è¡Œå–å‡º")
    print("   â€¢ æŒ‰è®¡åˆ’åˆ†æ‰¹å–å‡º")
    print("   â€¢ è®°å½•å®é™…æ”¶ç›Š")
    print("   â€¢ æ€»ç»“äº¤æ˜“ç»éªŒ")
    print()

def risk_management():
    """é£é™©ç®¡ç†å»ºè®®"""
    print("ğŸ›¡ï¸ é£é™©ç®¡ç†è¦ç‚¹")
    print("=" * 60)

    print("âš ï¸  å¿…é¡»è®¾ç½®æ­¢æŸï¼š")
    print("  â€¢ ä¹°å…¥åç«‹å³è®¾ç½®-5%æ­¢æŸå•")
    print("  â€¢ è‚¡ä»·è·Œç ´æ­¢æŸä½ç«‹å³å–å‡º")
    print("  â€¢ ä¸è¦æŠ±æœ‰ä¾¥å¹¸å¿ƒç†")
    print()

    print("ğŸ“ˆ æ­¢ç›ˆç­–ç•¥ï¼š")
    print("  â€¢ è¾¾åˆ°é¢„æœŸæ”¶ç›Š+4.84%è€ƒè™‘å‡ä»“")
    print("  â€¢ è¾¾åˆ°+7.3%å…¨éƒ¨å–å‡º")
    print("  â€¢ ä¸è¦è´ªå©ªï¼ŒåŠæ—¶æ­¢ç›ˆ")
    print()

    print("ğŸ’° ä»“ä½æ§åˆ¶ï¼š")
    print("  â€¢ å•åªè‚¡ç¥¨ä¸è¶…è¿‡æ€»èµ„é‡‘20%")
    print("  â€¢ æ€»æŒä»“ä¸è¶…è¿‡80%")
    print("  â€¢ ä¿ç•™20%ç°é‡‘åº”å¯¹æœºä¼š")
    print()

    print("ğŸ“Š å¸‚åœºç¯å¢ƒåˆ¤æ–­ï¼š")
    print("  â€¢ å¤§ç›˜ä¸‹è·Œæ—¶è°¨æ…æ“ä½œ")
    print("  â€¢ å¤§ç›˜ä¸Šæ¶¨æ—¶å¯é€‚å½“æ”¾å®½")
    print("  â€¢ é‡å¤§æ¶ˆæ¯æ—¶æš‚åœäº¤æ˜“")
    print()

def main():
    """ä¸»å‡½æ•°"""
    print("ğŸš€ 11:30é€‰è‚¡è¯¦ç»†å–å‡ºæ—¶æœºåˆ†æ")
    print("=" * 60)

    # åŠ è½½è‚¡ç¥¨æ•°æ®
    stocks = load_and_analyze_stocks()

    if not stocks:
        print("âŒ æœªæ‰¾åˆ°11:30é€‰è‚¡æ•°æ®")
        return

    # åˆ†æå–å‡ºæ—¶æœº
    analyze_sell_timings(stocks)

    # ç”Ÿæˆäº¤æ˜“è®¡åˆ’
    generate_trading_plan()

    # é£é™©ç®¡ç†
    risk_management()

    print("âœ… åˆ†æå®Œæˆï¼")
    print("ğŸ’¡ å»ºè®®ï¼šå…ˆç”¨å°èµ„é‡‘æµ‹è¯•ç­–ç•¥ï¼ŒéªŒè¯æœ‰æ•ˆåå†åŠ å¤§æŠ•å…¥")

if __name__ == "__main__":
    main()